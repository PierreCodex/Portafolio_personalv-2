<header
  class="fixed top-0 left-0 w-full z-[300] border-b border-black/10 dark:border-white/10 md:bg-transparent bg-white/85 dark:bg-[color-mix(in_oklab,var(--body-color2)_92%,black_8%)] md:dark:bg-transparent backdrop-blur supports-[backdrop-filter]:backdrop-blur transition-colors"
>
  <div
    class="relative flex justify-between items-center py-3 w-full max-w-4xl px-4 mx-auto"
  >
    <div class="flex items-center gap-3">
      <img class="w-12 h-12" src="/src/assets/LogoPCC (1).svg" alt="Logo" />
      <h1 class="text-xl font-semibold">PierreCodex</h1>
    </div>

    <!-- Botón Hamburguesa -->
    <button
      id="navToggle"
      aria-label="Abrir menú"
      aria-expanded="false"
      aria-controls="mobile-menu"
      class="md:hidden p-2 rounded focus:outline-none focus-visible:ring focus-visible:ring-blue-500 hover:bg-black/5 dark:hover:bg-white/10 transition"
    >
      <svg
        id="navIcon"
        class="w-6 h-6"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M3 6h18M3 12h18M3 18h18"></path>
      </svg>
    </button>

    <!-- Navegación Desktop -->
    <nav id="desktop-nav" class="hidden md:flex items-center gap-8" aria-label="Menú principal (desktop)">
      <a class="nav-link" data-nav href="#hero">Home</a>
      <a class="nav-link" data-nav href="#skills">Skills</a>
      <a class="nav-link" data-nav href="#projects">Proyectos</a>
      <a class="nav-link" data-nav href="#education">Educación</a>
    </nav>

    <!-- Menú Overlay Móvil -->
    <nav
      id="mobile-menu"
      class="mobile-overlay hidden fixed inset-0 flex-col gap-8 px-6 pt-[calc(var(--header-height)+0.75rem)] pb-16 z-[500] overflow-y-auto opacity-0 scale-[1.02] transition-all duration-300 ease-out pointer-events-none"
      aria-label="Menú principal (móvil)"
    >
      <button type="button" id="mobileClose" aria-label="Cerrar menú" class="absolute top-4 right-4 p-2 rounded-md text-[--text-color-light] hover:bg-black/5 dark:hover:bg-white/10 focus:outline-none focus-visible:ring focus-visible:ring-[--first-color]/60 transition">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 6l12 12M6 18L18 6" /></svg>
      </button>
      <div class="w-full flex flex-col items-center mb-2 animate-fade-in">
        <p class="text-[10px] tracking-[.2em] uppercase text-[--text-color-light] mb-3">Menu</p>
        <h2 class="text-lg font-semibold flex items-center gap-4 text-[--title-color] dark:text-[--title-color2]">
          <span class="h-px w-12 bg-gradient-to-r from-transparent via-[--first-color]/70 to-[--first-color]/10"></span>
          PierreCodex
          <span class="h-px w-12 bg-gradient-to-r from-[--first-color]/10 via-[--first-color]/70 to-transparent"></span>
        </h2>
      </div>
      <ul class="flex flex-col gap-6 w-full mx-auto max-w-xs text-center">
        <li><a class="nav-link mobile-nav-link" data-nav href="#hero">Home</a></li>
        <li><a class="nav-link mobile-nav-link" data-nav href="#skills">Skills</a></li>
        <li><a class="nav-link mobile-nav-link" data-nav href="#projects">Proyectos</a></li>
        <li><a class="nav-link mobile-nav-link" data-nav href="#education">Educación</a></li>
      </ul>
      <div class="mt-auto flex justify-center pt-10">
        <a href="#" class="cv-btn inline-flex items-center gap-2 px-5 py-3 rounded-md text-sm font-medium tracking-wide">Descargar CV <span aria-hidden="true">↓</span></a>
      </div>
    </nav>

    <div class="flex items-center gap-3">
      <button
        id="themeToggle"
        type="button"
        class="mt-2 md:mt-0 nav-link flex items-center gap-1 px-2 py-1 rounded-md border border-transparent hover:border-[--first-color]/40 hover:bg-black/5 dark:hover:bg-white/10 transition-colors"
        aria-label="Cambiar tema"
        title="Cambiar tema"
      >
        <span class="inline-flex" id="themeIcon"></span>
      </button>
    </div>
  </div>

  <script>
    // @ts-nocheck
    document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('navToggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const desktopNav = document.getElementById('desktop-nav');
      const icon = document.getElementById('navIcon');
      const header = document.querySelector('header');
      const links = Array.from(document.querySelectorAll('a[data-nav]'));
      const sectionIds = links
        .map(a => a.getAttribute('href') || '')
        .filter(h => h.startsWith('#'))
        .map(h => h.slice(1));

      // Menú móvil
      if (btn && mobileMenu) {
        const resetIcon = () => { if (icon) icon.innerHTML = '<path d="M3 6h18M3 12h18M3 18h18" />'; };
        // Asegura que el menú móvil (overlay) se porte al body para evitar stacking-context del header
        const ensureMobilePortal = () => {
          if (window.innerWidth < 768) {
            if (!mobileMenu.classList.contains('nav-portal')) {
              document.body.appendChild(mobileMenu);
              mobileMenu.classList.add('nav-portal');
            }
          } else {
            if (mobileMenu.classList.contains('nav-portal')) {
              // Reinsertar dentro del header antes del botón de tema (al final del contenedor principal)
              const headerInner = header?.querySelector('div.relative');
              if (headerInner) headerInner.appendChild(mobileMenu);
              mobileMenu.classList.remove('nav-portal');
              mobileMenu.classList.add('hidden');
              mobileMenu.classList.add('opacity-0');
              mobileMenu.classList.add('pointer-events-none');
            }
          }
        };
        ensureMobilePortal();
        const openNav = () => {
          mobileMenu.classList.remove('hidden');
          requestAnimationFrame(() => {
            mobileMenu.classList.remove('opacity-0','scale-[1.02]','pointer-events-none');
            document.body.style.overflow = 'hidden';
            document.body.classList.add('nav-open');
          });
          if (icon) icon.innerHTML = '<path d="M6 6l12 12M6 18L18 6" />';
        };
        const closeNav = () => {
          mobileMenu.classList.add('opacity-0','scale-[1.02]','pointer-events-none');
          document.body.style.overflow = '';
            document.body.classList.remove('nav-open');
          mobileMenu.addEventListener('transitionend', function handler(e){
            if (e.propertyName === 'opacity') { mobileMenu.classList.add('hidden'); mobileMenu.removeEventListener('transitionend', handler); }
          });
          resetIcon();
        };
        const closeBtn = document.getElementById('mobileClose');
        if (closeBtn) closeBtn.addEventListener('click', () => {
          if (btn.getAttribute('aria-expanded') === 'true') {
            btn.setAttribute('aria-expanded','false');
            closeNav();
          }
        });
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded) { closeNav(); } else { openNav(); }
          btn.setAttribute('aria-expanded', String(!expanded));
        });
        links.forEach(a => a.addEventListener('click', () => {
          if (window.innerWidth < 768 && btn.getAttribute('aria-expanded') === 'true') {
            btn.setAttribute('aria-expanded', 'false');
            closeNav();
          }
        }));
        window.addEventListener('resize', () => {
          if (window.innerWidth >= 768) {
            closeNav();
            btn.setAttribute('aria-expanded','false');
          }
          ensureMobilePortal();
        });
      }

      // Scrollspy
  /** @param {string|null} id */
  const setActive = (id) => {
        links.forEach(a => {
          const href = a.getAttribute('href');
          const match = id && href && href.substring(1) === id;
          a.classList.toggle('nav-link-active', !!match);
          if (match) a.setAttribute('aria-current', 'true'); else a.removeAttribute('aria-current');
        });
      };
      function onScroll() {
        const headerH = header ? header.offsetHeight : 0;
        const scrollPos = window.scrollY + headerH + 24;
        let current = null;
        for (const id of sectionIds) {
          const el = document.getElementById(id);
          if (el && el.offsetTop <= scrollPos) current = id;
        }
        setActive(current);
      }
      if (sectionIds.length) {
        document.addEventListener('scroll', onScroll, { passive: true });
        onScroll();
      }

      // Tema
      const themeBtn = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const setThemeVisual = () => {
        const dark = document.documentElement.classList.contains('dark');
        if (themeIcon) themeIcon.innerHTML = dark
          ? '<svg width="20" height="20" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"/></svg>'
          : '<svg width="20" height="20" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"/><path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"/>';
        if (themeBtn) themeBtn.setAttribute('aria-label', dark ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro');
      };
      if (themeBtn) {
        setThemeVisual();
        themeBtn.addEventListener('click', () => {
          const isDark = document.documentElement.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          setThemeVisual();
        });
      }
    });
  </script>
</header>